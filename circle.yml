machine:
  services:
    - docker

dependencies:
  pre:
    - if [ ! -d  ~/.go_workspace/src/github.com/timelinelabs ]; then mkdir -p ~/.go_workspace/src/github.com/timelinelabs; fi
    - if [ ! -e  ~/.go_workspace/src/github.com/timelinelabs/nsq-to-s3 ]; then ln -s ~/nsq-to-s3 ~/.go_workspace/src/github.com/timelinelabs; fi
    - make install-dev-tools
  override:
    - make dep-restore

test:
  pre:
    - docker run -d -p 4150:4150 -p 4151:4151 --name nsqd --net=host nsqio/nsq:v0.3.5 /nsqd
  override:
    - make build
    - make build-docker
    - cd ~/.go_workspace/src/github.com/timelinelabs/nsq-to-s3 && make cover-integration
notify:
  webhooks:
    - url: https://spudgun-staging.timelinelabs.net:16461/circleci
